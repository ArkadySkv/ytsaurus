package NYT.NQueryClient.NProto;

import "yt/ytlib/chunk_client/chunk_spec.proto";
import "yt/ytlib/table_client/table_chunk_meta.proto";
import "yt/ytlib/new_table_client/chunk_meta.proto";
import "yt/ytlib/query_client/expression.proto";

////////////////////////////////////////////////////////////////////////////////

message TNamedExpression
{
    required TExpression expression = 1;
    required string name = 2;
}

message TAggregateItem
{
    required TExpression expression = 1;
    required int32 aggregate_function = 2; // EAggregateFunction
    required string name = 3;
}

message TOperator
{
    required int32 kind = 1;

    extensions 100 to max;
}

message TScanOperator
{
    extend TOperator {
        optional TScanOperator scan_operator = 101;
    }
    repeated NYT.NChunkClient.NProto.TChunkSpec data_split = 1;

    required NYT.NVersionedTableClient.NProto.TTableSchemaExt table_schema = 2;
    required NYT.NTableClient.NProto.TKeyColumnsExt key_columns = 3;
}

message TFilterOperator
{
    extend TOperator {
        optional TFilterOperator filter_operator = 102;
    }
    required TOperator source = 1;
    required TExpression predicate = 2;
}

message TGroupOperator
{
    extend TOperator {
        optional TGroupOperator group_operator = 103;
    }
    required TOperator source = 1;
    repeated TNamedExpression group_items = 2;
    repeated TAggregateItem aggregate_items = 3;
}

message TProjectOperator
{
    extend TOperator {
        optional TProjectOperator project_operator = 104;
    }
    required TOperator source = 1;
    repeated TNamedExpression projections = 2;
}

////////////////////////////////////////////////////////////////////////////////

