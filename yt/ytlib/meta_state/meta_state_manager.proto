package NYT.NMetaState.NProto;

import "yt/ytlib/misc/guid.proto";

////////////////////////////////////////////////////////////////////////////////

message TMsgChangeHeader
{
    required bytes change_type = 1;
}

////////////////////////////////////////////////////////////////////////////////

message TReqReadSnapshot
{
    required int32 snapshot_id = 1;
    required int64 offset = 2;
    required int32 length = 3;
}

message TRspReadSnapshot
{
    optional int32 bytes_read = 1;
    // Snapshot data is passed via attachment.
}

////////////////////////////////////////////////////////////////////////////////

message TReqReadChangeLog
{
    required int32 change_log_id = 1;
    required int32 start_record_id = 2;
    required int32 record_count = 3;
}

message TRspReadChangeLog
{
    optional int32 records_read = 2;
    // Changelog records are passed via attachments
    // (one attachment per record).
}

////////////////////////////////////////////////////////////////////////////////

message TReqGetSnapshotInfo
{
    required int32 snapshot_id = 1;
}

message TRspGetSnapshotInfo
{
    optional int64 length = 1;
}

////////////////////////////////////////////////////////////////////////////////

message TReqGetChangeLogInfo
{
    required int32 change_log_id = 1;
}

message TRspGetChangeLogInfo
{
    optional int32 record_count = 2;
}
                                                                              
////////////////////////////////////////////////////////////////////////////////

message TReqPingFollower
{
    required int32 segment_id = 1;
    required int32 record_count = 2;
    required NYT.NProto.TGuid epoch = 3;
}

message TRspPingFollower
{
    required int32 status = 1;
}
                                                                              
////////////////////////////////////////////////////////////////////////////////

message TReqApplyChanges
{
    required int32 segment_id = 1;
    required int32 record_count = 2;
    required NYT.NProto.TGuid epoch = 3;
    // Data of changes are passed via attachment.
}

message TRspApplyChanges
{
    optional bool committed = 1;
}
                                                                              
////////////////////////////////////////////////////////////////////////////////

message TReqAdvanceSegment
{
    required int32 segment_id = 1;
    required int32 record_count = 2;
    required NYT.NProto.TGuid epoch = 3;
    required bool create_snapshot = 4;
}

message TRspAdvanceSegment
{
    optional uint64 checksum = 1;
}
                                                                              
////////////////////////////////////////////////////////////////////////////////

message TReqLookupSnapshot
{
	required int32 max_snapshot_id = 1;
}

message TRspLookupSnapshot
{
	required int32 snapshot_id = 1;
}

////////////////////////////////////////////////////////////////////////////////
