package NYT.NNodeTrackerClient.NProto;

import "yt/ytlib/misc/guid.proto";
import "yt/ytlib/misc/error.proto";
import "yt/ytlib/node_tracker_client/node.proto";
import "yt/ytlib/chunk_client/chunk.proto";

////////////////////////////////////////////////////////////////////////////////

// Describes the current state of a storage location.
message TLocationStatistics
{
    required int64 available_space = 1;
    required int64 used_space = 2;
    required int32 chunk_count = 3;
    required int32 session_count = 4;
    required bool enabled = 5;
    required bool full = 6;
}

// Describes the current state of the whole node.
message TNodeStatistics
{
    required int64 total_available_space = 1;
    required int64 total_used_space = 2;
    required int32 total_chunk_count = 3;
    required int32 total_session_count = 4;
    required bool full = 5;
    repeated TLocationStatistics locations = 6;
}

// Chunk Manager stuff.

message TChunkAddInfo
{
    required NYT.NProto.TGuid chunk_id = 1;
    required bool cached = 2;
    required NYT.NChunkClient.NProto.TChunkInfo chunk_info = 3;
}

message TChunkRemoveInfo
{
    required NYT.NProto.TGuid chunk_id = 1;
    required bool cached = 2;
}

message TJobInfo
{
    required NYT.NProto.TGuid job_id = 1;
    required int32 state = 2;
    optional NYT.NProto.TError error = 3;
}

message TJobStartInfo
{
    required int32 type = 1;
    required NYT.NProto.TGuid job_id = 2;
    required NYT.NProto.TGuid chunk_id = 3;
    repeated NYT.NNodeTrackerClient.NProto.TNodeDescriptor targets = 4;
}

message TJobStopInfo
{
    required NYT.NProto.TGuid job_id = 1;
}

////////////////////////////////////////////////////////////////////////////////

message TReqRegisterNode
{
    required TNodeDescriptor node_descriptor = 1;
    required TNodeStatistics statistics = 2;
    required NYT.NProto.TGuid cell_guid = 3;
}

message TRspRegisterNode
{
    required int32 node_id = 1;
    required NYT.NProto.TGuid cell_guid = 2;
}

////////////////////////////////////////////////////////////////////////////////

message TReqFullHeartbeat
{
    required int32 node_id = 1;
    required TNodeStatistics statistics = 2;

    // Chunk Manager stuff.
    repeated TChunkAddInfo chunks = 3;
}

message TRspFullHeartbeat
{ }

////////////////////////////////////////////////////////////////////////////////

message TReqIncrementalHeartbeat
{
    required int32 node_id = 1;
    required TNodeStatistics statistics = 2;

    // Chunk Manager stuff.
    repeated TChunkAddInfo added_chunks = 3;
    repeated TChunkRemoveInfo removed_chunks = 4;
    repeated TJobInfo jobs = 5;
}

message TRspIncrementalHeartbeat
{
    // Chunk Manager stuff.
    repeated TJobStartInfo jobs_to_start = 2;
    repeated TJobStopInfo jobs_to_stop = 3;
}

////////////////////////////////////////////////////////////////////////////////
