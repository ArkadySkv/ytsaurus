package NYT.NChunkServer.NProto;

////////////////////////////////////////////////////////////////////////////////

message THolderStatistics
{
    required int64 AvailableSpace = 1;
    required int64 UsedSpace = 2;
    required int32 ChunkCount = 3;
    required int32 SessionCount = 4;
}

message TChunkInfo
{
    required bytes Id = 1;
    required int64 Size = 2;
}

////////////////////////////////////////////////////////////////////////////////

message TReqRegisterHolder
{
    required bytes Address = 1;
    required THolderStatistics Statistics = 2;
}

message TRspRegisterHolder
{
    required int32 HolderId = 1;
}

////////////////////////////////////////////////////////////////////////////////

message TJobInfo
{
    required bytes JobId = 1;
    required int32 State = 2;
}

message TJobStartInfo
{
    required int32 Type = 1;
    required bytes JobId = 2;
    required bytes ChunkId = 3;
    repeated bytes TargetAddresses = 4;
}

message TReqHolderHeartbeat
{
    required int32 HolderId = 1;

    required THolderStatistics Statistics = 2;

    repeated TChunkInfo AddedChunks = 3;
    repeated bytes RemovedChunks = 4;

    repeated TJobInfo Jobs = 5;
}

message TRspHolderHeartbeat
{
    repeated bytes ChunksToRemove = 1;
    repeated TJobStartInfo JobsToStart = 2;
    repeated bytes JobsToStop = 3;
}

////////////////////////////////////////////////////////////////////////////////

message TReqCreateChunk
{
    required bytes TransactionId = 1;
    required int32 ReplicaCount = 2;
}

message TRspCreateChunk
{
    required bytes ChunkId = 1;
    repeated bytes HolderAddresses = 2;
}

////////////////////////////////////////////////////////////////////////////////

message TReqFindChunk
{
    required bytes TransactionId = 1;
    required bytes ChunkId = 2;
}

message TRspFindChunk
{
    repeated bytes HolderAddresses = 1;
}

////////////////////////////////////////////////////////////////////////////////
