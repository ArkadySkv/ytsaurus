{% note info %}

Документация переехала на новый инструмент деплоя (от Яндекс.Облака). Теперь в документации поддерживается синтаксис YFM. Подробнее про синтаксис в репозитории [YFM](https://github.yandex-team.ru/data-ui/yfm/blob/master/DOCS.md).

Ключевые изменения:

- Оглавление перхало в файл `toc.yaml`;
- Настройки лежат в файле `.yfm`;
- В Аркануме появился виджет, который позволяет выкатить документацию в [production](http://docs.yandex-team.ru)/[testing](https://testing.docs.yandex-team.ru);
- Сейчас настроен авторелиз документации, все что попадет в trunk будет автоматически выложено в [production](http://docs.yandex-team.ru) и [testing](https://testing.docs.yandex-team.ru);
- На каждый pull request в комментарий будет прибегать робот и давать ссылку на свежую документацию.

{% endnote %}

# Структура документации

Корень документации находится в `yt/docs`. Здесь находятся статьи, из которых собирается как внутренняя документация, так и внешняя. Для внешней документации существует англоязычная версия.

Значимая часть документов переиспользуется во внутренней и внешней документации. Общие документы находятся в `yt/docs/ru/_includes` и `yt/docs/en/_includes`. 

Статьи для внутренней документации находятся в директории `yt/docs/ru/yandex-specific`. Если вам необходимо внести изменения в имеющуюся статью внутренней документации, необходимо найти соответствующий `.md` файл в директории `yandex-specific` и отредактировать его. Может быть так, что статья внутренней документации ссылается на общий источник в `_includes`. В таком случае может потребоваться внести изменение в общий источник. 

{% note warning "Внимание" %}

Помните, что при редактировании общего документа стоит следить, чтобы в него не попала информация, подпадающая под NDA. В общем документе не должно быть данных, не относящихся к OpenSource версии продукта. Не допускаются любые ссылки в домене yandex-team.ru, логины сотрудников, названия внутренних кластеров.

{% endnote %}

## Оглавление

Оглавление как внутренней, так и внешней документации формируется на основе файла `yt/docs/ru/toc.yaml`. Каждый раздел оглавления может быть размечен условием, в какой из версий документации он отображается:

- `when: audience == "internal"` — раздел будет отображаться только при сборке внутренней документации
- `when: audience == "public"` — раздел будет отображаться только при сборке внешней документации
- при отсутствии условия, раздел будет включён в оглавление как внутренней, так и внешней документации.

Часть оглавления внутренней докуменатции целиком заимствуется из файла `yt/docs/ru/yandex-specific/toc-internal.md`, который в свою очередь тоже может содержать заимствования. Так например, оглавление внутренней документации по YQL заимствуется из файла `yt/docs/ru/yandex-specific/yql/toc.yaml`.

## Перевод на английский

Если вы вносите небольшие правки в имеющийся русскоязычный документ и хотите чтобы изменения в англоязычной версии стали быстрее доступны для внешних пользователей, можете самостоятельно выполнить перевод и внести правки как в русский так и в англоязычный документ в одном pull request.

Для поддержания соответствия русской и английской версий документации выстроен процесс с командой локализации. Базовой версией считается русскоязычный вариант документов. Актуальные версии русскоязычных документов загружаются в специальную программу, где для каждого участка текста, чаще всего это предложение, имеется сохранённый вариант перевода, т.н. translation memory. В случае изменения исходного фрагмента или при добавлении нового текста, запускается процесс перевода с последующей вычиткой редактором. На выходе получаем переведённые документы и добавляем их в trunk. Перевод согласуется с автором изменений в оригинальную документацию в рамках pull request. При необходимости вносятся исправления.


# Как написать новую страницу или внести изменения

1. Создаем страницу, например `test_page.md` в папке **arcadia/yt/docs**:

   ```bash
   touch arcadia/yt/docs/test_page.md
   ```

2. Добавляем ее в SVN и выставляем тип  `text/markdown`:

   ```bash
   svn add test_page.md
   svn propset svn:mime-type 'text/markdown' test_page.md
   ```

3. Наполняем страницу текстом. Предварительно рекомендуется прочесть раздел [Общие правила оформления документации](#Общие правила оформления документации), который находится ниже;

4. Добавляем файл в оглавление `toc.yml`;

5. Собираем файл и проверяем его локально:

   ```bash
   mkdir docs
   ya make
   tar -xzf docs.tar.gz -C docs
   python3 -m http.server 8888 -d docs
   или
   cd docs
   python ../dev-server.py
   ```

   Либо делаем pull request:

   ```bash
   ya pr create -m 'My new page'
   ```

6. Если все хорошо, заливаем изменения в SVN:

   ```bash
   svn commit -m 'My new page'
   ```


# Краткая справка про используемый диалект Markdown

* Заголовки на отдельной строке начиная с `# `, `## ` или `### `.
* Выделение жирным в `**звёздочках**` или `__подчеркиваниях__`.
* Ссылки `[якорь](http://...)`, картинки `![с восклицательным знаком](http://...jpeg)`.
* Списки на строках начинающихся с `* неупорядоченный` или `1. упорядоченный`.
* Кусочек кода по тексту <code>&#96;в backtick&#96;</code>.
* Блок кода начинается и заканчивается на строку <code>&#96;&#96;&#96;с тремя backtick&#96;&#96;&#96;</code>.
* Яркий блок с информацией `{% note info %}`, на следующей строке текст без отступа, на слудющей строке `{% endnote %}`, после `note` может быть `warning` для предупреждений.

* Скрыть блок за кликом: `<details markdown="1"> <summary>Заголовок</summary> скрываемый контент</details>`.
* Цветной текст: `<span style="color: red;">текст</span>`.
* Дополнительный якорь, куда можно ссылаться: `<a name="my_anchor"></a>`, у заголовков полностью на английском они создаются автоматически по принципу `"FoO Bar" -> "foo-bar"`.
* Таблица:
```
| Заголовок 1 | Заголовок 2 | Заголовок 3 |
| ----------- | ----------- | ----------- |
| Ячейка   А1 | Ячейка   А2 | Ячейка   А3 |
| Ячейка   Б1 | Ячейка   Б2 | Ячейка   Б3 |
| Ячейка   В1 | Ячейка   В2 | Ячейка   В3 |
```


# Общие правила оформления документации

## Описание раздела

Каждый раздел начинается с краткого обзора, о чем будет идти речь:

*В данном разделе собрана информация о системе контроля доступа к таблицам и другим узлам [Кипариса](user-guide/storage/cypress.md) (пользователям, группам, аккаунтам, чанкам, транзакциям и т.д.).*

## Ссылка на другой раздел

Название раздела в ссылке необходимо писать с большой буквы. Например:

*Подробное описание параметров пользовательского скрипта приведено в разделе [Настройки операций](user-guide/data-processing/operations/operations-options.md#user_script_options).*

## Заголовки

Заголовки должны иметь якоря:

```
##### Пользователи, группы {: #users_groups :}
```

## Списки

Каждый элемент упорядоченного списка начинается с большой буквы, а неупорядоченного списка начинается с маленькой буквы и заканчивается символом ';'. Последний элемент списка заканчивается точкой.

**Упорядоченный:**

1. Вида доступа (чтение, запись и т.д.);
2. Пользователя, инициировавшего запрос;
3. Объекта, к которому доступ запрашивается.

**Неупорядоченный:**

* вида доступа (чтение, запись и т.д.);
* пользователя, инициировавшего запрос;
* объекта, к которому доступ запрашивается.

## Инфоблоки

Информационные примечания задаются: `{% note info %} ... {% endnote %}`. Само примечание начинается с большой буквы.

```
{% note info "Примечание" %}

Права на создание и удаление групп в данный момент не выдаются пользователям и осуществляются через форму или вкладку ACL узла в веб-интерфейсе. Добавление/удаление пользователей в группы делегированы ответственным через IDM.

{% endnote %}
```

Предупреждающие примечания задаются: `{% note warning %} ... {% endnote %}`. Само примечание начинается с большой буквы.

```
{% note info "Примечание" %}

Пользователи и группы располагаются в одном пространстве имен, то есть имена пользователей и групп не могут совпадать.

{% endnote %}
```

Если для понимания раздела есть требования, то они оформляются следующим образом:

```
{% note warning "Внимание" %}

Для понимания изложенного в разделе материала требуется знание основ/устройства/принципов ... того-то (со ссылками)

{% endnote %}
```

## Таблицы

На таблицу должна быть ссылка: **В таблице 1 представлен**...
Обязательно наличие слов: **Таблица N — *Название таблицы с большой буквы, без точки в конце***

Пример:

<small>Таблица 1 — Атрибуты субъектов</small>

| **Атрибут**         | **Тип**         | **Описание**                                                 |
| ------------------- | --------------- | ------------------------------------------------------------ |
| `name`              | `string`        | Имя субъекта (непустая строка)                               |
| `member_of`         | `array<string>` | Список имен групп, которым непосредственно принадлежит данный субъект |
| `member_of_closure` | `array<string>` | Список имен групп, которым принадлежит субъект (прямо или косвенно) |

Листинги

Аналогично таблицам. Желательна ссылка на листинг. Название с большой буквы, без точек на конце. Например: "в листинге 1 приведен пример запуска проверки ACL".

<small>Листинг 1 — Пример запуска проверки ACL</small>

```bash
yt check-permission yql write //tmp
{
    "action" = "allow";
    "object_id" = "1-3-411012f-1888ce1f";
    "object_name" = "node //tmp";
    "subject_id" = "c4-8aaa-41101f6-bec6113b";
    "subject_name" = "yandex";
}
```
